<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/jpeg" href="c7.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Row Filter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            color: #1d1d1f;
            line-height: 1.6;
        }
        .hero {
            background: #fff;
            padding: 60px 20px;
            text-align: center;
            border-bottom: 1px solid #d2d2d7;
        }
        h1 {
            font-size: 48px;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 12px;
        }
        .subtitle {
            font-size: 21px;
            color: #6e6e73;
            font-weight: 400;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px;
        }
        .card {
            background: #fff;
            border-radius: 18px;
            padding: 48px;
            margin-bottom: 20px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.06);
        }
        .form-group {
            margin-bottom: 32px;
        }
        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 12px;
            letter-spacing: -0.01em;
        }
        input[type="file"] {
            width: 100%;
            padding: 16px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 15px;
            background: #fff;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        input[type="file"]:hover {
            border-color: #86868b;
        }
        input[type="file"]:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }
        input[type="number"], input[type="text"] {
            width: 120px;
            padding: 14px 16px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 15px;
            background: #fff;
            transition: all 0.2s ease;
        }
        input[type="text"] {
            width: 100px;
        }
        input[type="number"]:hover, input[type="text"]:hover {
            border-color: #86868b;
        }
        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }
        textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 14px;
            resize: vertical;
            background: #fff;
            transition: all 0.2s ease;
            min-height: 140px;
        }
        textarea:hover {
            border-color: #86868b;
        }
        textarea:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }
        .btn {
            display: inline-block;
            padding: 14px 32px;
            background: #0071e3;
            color: #fff;
            border: none;
            border-radius: 980px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: -0.01em;
        }
        .btn:hover {
            background: #0077ed;
            transform: scale(1.02);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-secondary {
            background: #f5f5f7;
            color: #1d1d1f;
            margin-left: 12px;
        }
        .btn-secondary:hover {
            background: #e8e8ed;
        }
        .status {
            margin-top: 24px;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14px;
            display: none;
            background: #f5f5f7;
            color: #1d1d1f;
        }
        .status.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .accordion {
            margin-top: 40px;
        }
        .accordion-header {
            background: #f5f5f7;
            padding: 20px 24px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            user-select: none;
        }
        .accordion-header:hover {
            background: #e8e8ed;
        }
        .accordion-title {
            font-size: 17px;
            font-weight: 600;
            color: #1d1d1f;
        }
        .accordion-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1d1d1f;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: transform 0.3s ease;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .accordion-content.open {
            max-height: 600px;
        }
        .accordion-content-inner {
            padding: 32px 0 16px 0;
        }
        .helper-text {
            font-size: 13px;
            color: #86868b;
            margin-top: 8px;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 32px;
        }
        .form-row .form-group {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>Excel Filter</h1>
        <p class="subtitle">Filter rows by numbers. Simple and fast.</p>
    </div>

    <div class="container">
        <div class="card">
            <div class="form-group">
                <label>Select Excel File</label>
                <input type="file" id="excelFile" accept=".xlsx,.xls">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Header Row Number</label>
                    <input type="number" id="headerRow" value="7" min="1">
                    <p class="helper-text">Which row contains column headers</p>
                </div>
                
                <div class="form-group">
                    <label>Column to Compare</label>
                    <input type="text" id="columnLetter" value="F" placeholder="A, B, C, etc.">
                    <p class="helper-text">Column letter (e.g., F for column F)</p>
                </div>
            </div>

            <div class="form-group">
                <label>Numbers to Filter (Exact Match)</label>
                <textarea id="numberList" rows="6" placeholder="Enter numbers (one per line or comma-separated)&#10;&#10;Example:&#10;123&#10;456&#10;789"></textarea>
                <p class="helper-text">Rows with EXACT matches in the selected column will be included</p>
            </div>

            <button class="btn" onclick="filterExcel()">Filter and Download</button>

            <div id="filterStatus" class="status"></div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion()">
                    <span class="accordion-title">Number Extractor Tool</span>
                    <span class="accordion-icon" id="accordionIcon">+</span>
                </div>
                <div class="accordion-content" id="accordionContent">
                    <div class="accordion-content-inner">
                        <div class="form-group">
                            <label>Paste Text with Numbers</label>
                            <textarea id="messyText" rows="5" placeholder="Paste any text containing numbers...&#10;&#10;Example: Item #123, Price $45.99, Code ABC-456"></textarea>
                        </div>

                        <button class="btn" onclick="extractNumbers()">Extract</button>
                        <button class="btn btn-secondary" onclick="copyNumbers()">Copy</button>

                        <div class="form-group" style="margin-top: 24px;">
                            <label>Extracted Numbers</label>
                            <textarea id="cleanNumbers" rows="5" readonly placeholder="Clean numbers will appear here..."></textarea>
                        </div>

                        <div id="extractStatus" class="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleAccordion() {
            const content = document.getElementById('accordionContent');
            const icon = document.getElementById('accordionIcon');
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.textContent = '+';
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('open');
                icon.textContent = '−';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        function showStatus(id, message) {
            const status = document.getElementById(id);
            status.textContent = message;
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 4000);
        }

        function parseNumbers(text) {
            const numbers = new Set();
            const matches = text.match(/\d+/g);
            if (matches) {
                matches.forEach(num => numbers.add(num));
            }
            return Array.from(numbers);
        }

        // Function to convert column letter to zero-based index
        function columnLetterToIndex(letter) {
            letter = letter.toUpperCase();
            let column = 0;
            for (let i = 0; i < letter.length; i++) {
                column = column * 26 + (letter.charCodeAt(i) - 64);
            }
            return column - 1; // Zero-based index
        }

        function filterExcel() {
            const fileInput = document.getElementById('excelFile');
            const numberList = document.getElementById('numberList').value.trim();
            const headerRowNum = parseInt(document.getElementById('headerRow').value);
            const columnLetter = document.getElementById('columnLetter').value.trim().toUpperCase();
            
            if (!fileInput.files.length) {
                showStatus('filterStatus', '⚠️ Please select an Excel file');
                return;
            }
            
            if (!numberList) {
                showStatus('filterStatus', '⚠️ Please enter numbers to filter');
                return;
            }
            
            if (!headerRowNum || headerRowNum < 1) {
                showStatus('filterStatus', '⚠️ Please enter a valid header row number');
                return;
            }
            
            if (!columnLetter || !/^[A-Z]+$/.test(columnLetter)) {
                showStatus('filterStatus', '⚠️ Please enter a valid column letter (A-Z)');
                return;
            }
            
            const searchNumbers = parseNumbers(numberList);
            if (searchNumbers.length === 0) {
                showStatus('filterStatus', '⚠️ No valid numbers found in your input');
                return;
            }
            
            showStatus('filterStatus', '⏳ Processing your file...');
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array', cellStyles: true});
                    const newWorkbook = XLSX.utils.book_new();
                    
                    let totalRows = 0;
                    const headerRowIndex = headerRowNum - 1;
                    const columnIndex = columnLetterToIndex(columnLetter);
                    
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const range = XLSX.utils.decode_range(worksheet['!ref']);
                        
                        const allRows = [];
                        for (let R = range.s.r; R <= range.e.r; R++) {
                            const row = [];
                            for (let C = range.s.c; C <= range.e.c; C++) {
                                const cellAddress = XLSX.utils.encode_cell({r: R, c: C});
                                const cell = worksheet[cellAddress];
                                row.push(cell ? cell.v : '');
                            }
                            allRows.push(row);
                        }
                        
                        const filteredRows = [];
                        for (let i = 0; i <= headerRowIndex && i < allRows.length; i++) {
                            filteredRows.push(allRows[i]);
                        }
                        
                        for (let i = headerRowIndex + 1; i < allRows.length; i++) {
                            const row = allRows[i];
                            
                            // Check only the specified column
                            if (columnIndex < row.length) {
                                const cellValue = String(row[columnIndex]).trim();
                                const hasExactMatch = searchNumbers.some(num => {
                                    // Exact match comparison
                                    return cellValue === num;
                                });
                                
                                if (hasExactMatch) {
                                    filteredRows.push(row);
                                }
                            }
                        }
                        
                        totalRows += (filteredRows.length - headerRowIndex - 1);
                        
                        if (filteredRows.length > headerRowIndex) {
                            const newWorksheet = XLSX.utils.aoa_to_sheet(filteredRows);
                            
                            // Highlight the comparison column header in red
                            if (columnIndex < filteredRows[headerRowIndex].length) {
                                const cellAddress = XLSX.utils.encode_cell({r: headerRowIndex, c: columnIndex});
                                if (!newWorksheet[cellAddress]) {
                                    newWorksheet[cellAddress] = {t: 's', v: filteredRows[headerRowIndex][columnIndex]};
                                }
                                newWorksheet[cellAddress].s = {
                                    fill: {fgColor: {rgb: "FF0000"}},
                                    font: {color: {rgb: "FFFFFF"}, bold: true}
                                };
                            }
                            
                            // Also add red background to all header row cells for consistency
                            for (let C = range.s.c; C <= range.e.c && C < filteredRows[headerRowIndex].length; C++) {
                                const cellAddress = XLSX.utils.encode_cell({r: headerRowIndex, c: C});
                                if (!newWorksheet[cellAddress]) {
                                    newWorksheet[cellAddress] = {t: 's', v: filteredRows[headerRowIndex][C]};
                                }
                                if (C === columnIndex) {
                                    newWorksheet[cellAddress].s = {
                                        fill: {fgColor: {rgb: "FF0000"}},
                                        font: {color: {rgb: "FFFFFF"}, bold: true}
                                    };
                                } else {
                                    newWorksheet[cellAddress].s = {
                                        fill: {fgColor: {rgb: "F5F5F7"}},
                                        font: {bold: true}
                                    };
                                }
                            }
                            
                            if (worksheet['!cols']) {
                                newWorksheet['!cols'] = worksheet['!cols'];
                            }
                            
                            XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, sheetName);
                        }
                    });
                    
                    if (totalRows === 0) {
                        showStatus('filterStatus', `❌ No exact matches found in column ${columnLetter}`);
                        return;
                    }
                    
                    const wbout = XLSX.write(newWorkbook, {bookType: 'xlsx', type: 'array', cellStyles: true});
                    const blob = new Blob([wbout], {type: 'application/octet-stream'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'filtered_' + file.name;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showStatus('filterStatus', `✓ Success! Found ${totalRows} exact matches in column ${columnLetter}`);
                } catch (error) {
                    showStatus('filterStatus', '❌ Error: ' + error.message);
                }
            };
            
            reader.onerror = function() {
                showStatus('filterStatus', '❌ Error reading file');
            };
            
            reader.readAsArrayBuffer(file);
        }

        function extractNumbers() {
            const messyText = document.getElementById('messyText').value;
            const numbers = messyText.match(/\d+/g);
            
            if (numbers && numbers.length > 0) {
                document.getElementById('cleanNumbers').value = numbers.join('\n');
                showStatus('extractStatus', `✓ Extracted ${numbers.length} numbers`);
            } else {
                document.getElementById('cleanNumbers').value = '';
                showStatus('extractStatus', '⚠️ No numbers found in text');
            }
        }

        function copyNumbers() {
            const cleanNumbers = document.getElementById('cleanNumbers');
            if (cleanNumbers.value) {
                cleanNumbers.select();
                document.execCommand('copy');
                showStatus('extractStatus', '✓ Copied to clipboard');
            } else {
                showStatus('extractStatus', '⚠️ No numbers to copy');
            }
        }
    </script>
</body>
</html>
